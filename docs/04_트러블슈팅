# Docs

프로젝트 설계 및 개발 과정에서의 주요 문서와 인증 구현 중 발생한 이슈를 정리한다.

---

## 인증(JWT) 구현 과정 중 주요 이슈 정리

본 프로젝트는 React + Spring Boot 분리 환경에서  
JWT 기반 인증/권한 구조를 직접 구현하며 다음과 같은 이슈들을 경험하고 해결하였다.

---

### 1️. H2 DB에서 User 테이블 조회 오류

- **증상**
  - 로그인 요청 시 사용자 조회 쿼리에서 `JdbcSQLSyntaxErrorException` 발생

- **원인**
  - `user` 테이블명이 H2 예약어/식별자와 충돌

- **해결**
  - User 엔티티의 테이블명을 `users`로 변경

- **검증**
  - `/auth/login` 요청 시 사용자 조회 쿼리 정상 동작 확인

---

### 2️. 인증된 요청에서 403 Forbidden 발생

- **증상**
  - 로그인 이후 `/cart/**` API 호출 시 403 응답 발생

- **관찰**
  - 브라우저 DevTools Network 탭에서 Request Header 확인

- **원인**
  - axios interceptor에서 Authorization 헤더가 실제 JWT 값이 아닌  
    문자열 형태(`Bearer ${token}`)로 전송되고 있었음

- **해결**
  - 템플릿 문자열을 백틱(`\``)으로 수정하여 실제 토큰 값이 주입되도록 변경

- **검증**
  - `Authorization: Bearer eyJ...` 형태로 헤더가 전달되는 것 확인 후 정상 응답 수신

---

### 3. 로그인 버튼 클릭 시 인증 요청이 실행되지 않는 문제

- **증상**
  - 로그인 버튼 클릭 시 서버 요청이 발생하지 않음

- **관찰**
  - 브라우저 콘솔에서 `ReferenceError` 발생 확인

- **원인**
  - 로그인 컴포넌트에서 에러 메시지 상태(`setMsg`) 선언 누락으로  
    런타임 에러 발생 → 인증 API 호출 로직 자체가 실행되지 않음

- **해결**
  - 누락된 state 선언 추가

- **검증**
  - `/auth/login` 요청이 정상적으로 전송되는 것 확인

---

### 4. 임시 인증 방식 전환 과정에서 Authorization 헤더 혼선

- **증상**
  - 인증 로직 전환 후에도 의도하지 않은 토큰 값이 Authorization 헤더에 포함됨

- **원인**
  - 임시 로그인 단계에서 사용하던 토큰 값이  
    localStorage 및 axios 설정에 잔존

- **해결**
  - 요청 인터셉터에서 토큰 존재 여부에 따라  
    Authorization 헤더를 명시적으로 설정 / 제거하도록 수정

- **검증**
  - 토큰 미존재 시 보호 API 접근 차단  
  - 토큰 존재 시 정상 접근 확인

---

## 정리

위 이슈들은 단순한 오류 수정이 아니라,  
프론트엔드 → 네트워크 → 백엔드 필터 → 시큐리티 설정으로 이어지는  
**JWT 인증 흐름 전반을 추적하고 검증한 과정**이다.

인증 실패 상황을 Network / Console 로그를 기준으로 분석하고  
문제 지점을 단계적으로 분리하여 해결하였다.
