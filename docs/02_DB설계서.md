# DB 설계서
프로젝트: 농구공 쇼핑몰
작성일: 2025-09-04
작성자: 황상하

---

## 1. ERD 다이어그램
![ERD](./images/ERD.png)

---

## 2. 주요 테이블 정의

### user
- id (PK, BIGINT, AUTO)
- email (VARCHAR 255, UNIQUE)
- password_hash (VARCHAR 255)
- name (VARCHAR 100)
- phone (VARCHAR 20)
- status (ENUM: ACTIVE, SUSPENDED)
- created_at, updated_at

### product
- id (PK)
- category_id (FK)
- name, brand
- slug (UNIQUE)
- description (TEXT)
- list_price (DECIMAL 12,2)
- status (ENUM: ON_SALE, HIDDEN, DISCONTINUED)

### product_option
- id (PK)
- product_id (FK)
- sku (VARCHAR 64, UNIQUE)
- attributes_json (JSON)  // 예: {"size":"7호","surface":"indoor"}
- sale_price (DECIMAL 12,2)
- is_active (BOOLEAN)

### inventory
- option_id (PK, FK product_option.id)
- quantity (INT)
- safety_stock (INT)
- updated_at

### cart / cart_item
- cart: id (PK), user_id (FK), updated_at
- cart_item: id (PK), cart_id (FK), option_id (FK), quantity (INT), added_at

### order / order_item
- order: id (PK), user_id (FK), order_number (UNIQUE), status, total_amount, final_amount, created_at
- order_item: id (PK), order_id (FK), option_id (FK), product_name_snapshot, option_attrs_snapshot, unit_price, quantity, sub_total

### payment
- id (PK), order_id (FK UNIQUE)
- provider (ENUM: MOCK, TOSS, KAKAO)
- method (ENUM: CARD, TRANSFER, VIRTUAL)
- amount (DECIMAL 12,2)
- tx_id (UNIQUE)
- status (ENUM: INIT, AUTHORIZED, CAPTURED, CANCELED, FAILED)

### shipment
- id (PK), order_id (FK UNIQUE)
- courier, tracking_no
- status (ENUM: READY, PICKED, IN_TRANSIT, OUT_FOR_DELIVERY, DELIVERED)

### review
- id (PK)
- order_item_id (FK UNIQUE)
- rating (TINYINT 1~5)
- content (TEXT)
- created_at, updated_at

---

## 3. 관계 요약
- user (1) — (N) order
- order (1) — (N) order_item
- product (1) — (N) product_option
- product_option (1) — (1) inventory
- user (1) — (1) cart, cart (1) — (N) cart_item
- order (1) — (1) payment
- order (1) — (1) shipment
- order_item (1) — (0..1) review

---

## 4. 메모
- 리뷰 테이블은 향후 활성화를 위해 미리 정의
- 주문 생성 시 재고 차감은 `SELECT ... FOR UPDATE`로 트랜잭션 처리
